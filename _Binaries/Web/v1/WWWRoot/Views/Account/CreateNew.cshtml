@model RegisterNewUserModel
@{
    if(Model==null || Model.Iid==null)
    {
        ViewBag.Title = "Новый пользователь";
    }
    else
    {
        ViewBag.Title = String.Format("Правка пользователя {0}", Model.Name);
    }
    bool selfEdit = ViewBag.SelfEdit == null ? false : (bool)ViewBag.SelfEdit;
    bool editSuccess = ViewBag.EditSuccess == null ? false : (bool)ViewBag.EditSuccess;
}

<h2>@ViewBag.Title</h2>
@if (editSuccess)
{
    <p class="message-success">Данные сохранены</p>
}
@Html.ValidationSummary(true)
@using (Html.BeginForm("Save", "Account", new { selfEdit = selfEdit }, FormMethod.Post))
{
    @Html.HiddenFor(m => m.Iid)
    @Html.HiddenFor(m => m.CanEditPassword)
    @Html.AntiForgeryToken()
    <fieldset>
        <legend>RegisterNewUserModel</legend>
        <div class="editor-label">
            @Html.LabelFor(m => m.Name)
        </div>
        <div class="editor-field">
            @Html.EditorFor(m => m.Name)
            @Html.ValidationMessageFor(m => m.Name)
        </div>

        <div class="editor-label">
            @Html.LabelFor(m => m.Email)
        </div>
        <div class="editor-field">
            @Html.EditorFor(m => m.Email)
            @Html.ValidationMessageFor(m => m.Email)
        </div>

        <div class="editor-label">
            @Html.LabelFor(m => m.RegionId)
        </div>
        <div class="editor-field">
            @Html.DropDownListFor(m => m.RegionId, (SelectList)ViewBag.Regions)
            @Html.ValidationMessageFor(m => m.RegionId)
        </div>
        
        @if (Model.CanEditPassword)
        {
            <div class="editor-label">
                @Html.LabelFor(m => m.OldPassword)
            </div>
            <div class="editor-field">
                @Html.EditorFor(m => m.OldPassword)
                @Html.ValidationMessageFor(m => m.OldPassword)
            </div>
            
            <div class="editor-label">
                @Html.LabelFor(m => m.NewPassword)
            </div>
            <div class="editor-field">
                @Html.EditorFor(m => m.NewPassword)
                @Html.ValidationMessageFor(m => m.NewPassword)
            </div>
            
            <div class="editor-label">
                @Html.LabelFor(m => m.ConfirmPassword)
            </div>
            <div class="editor-field">
                @Html.EditorFor(m => m.ConfirmPassword)
                @Html.ValidationMessageFor(m => m.ConfirmPassword)
            </div>
        }
    </fieldset>
    <input type="submit" value="Сохранить данные" />
}
@if(!selfEdit)
{
    @Html.ActionLink("К списку пользователей", "Index", new { zone = Model.Zone })
}